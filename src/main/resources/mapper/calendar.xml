<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="caldao">
	<resultMap type="caldto" id="calMap">
		<result property="title" column="cal_title"/>
		<result property="start" column="cal_start_time"/>
		<result property="end" column="cal_end_time"/>
		<result property="allDay" column="cal_allday"/>
	</resultMap>
 	
 	<!-- *******************현우**********************-->
 	<select id="calList" parameterType="int" resultMap="calMap">
		<!-- select * from calendar where mem_no = #{mem_no} -->
		select * from calendar c join member m
		on c.mem_no = m.mem_no
		where c.mem_no = #{mem_no}
	</select>
	
	<insert id="calAdd" parameterType="caldto">
		<selectKey resultType="int" keyProperty="cal_no" order="BEFORE">
			select max(cal_no) from calendar
		</selectKey>
		insert into calendar values(#{cal_no}+1,
		(select distinct c.mem_no from calendar c join member m
		on c.mem_no = m.mem_no
		where m.mem_no = #{mem_no}), #{cal_mark}, #{title}, to_date(#{start},'yyyy.mm.dd hh24:mi'), to_date(#{end},'yyyy.mm.dd hh24:mi'),
		#{allDay},#{cal_repeat},'','','','', default, '', #{cal_attendee1},'','','','','',#{cal_type_name},#{cal_place},#{cal_memo},#{cal_file},
		#{cal_category},'',#{cal_status})
	</insert>
	
	<update id="calUpdate_drag" parameterType="caldto">
		update calendar set cal_start_time = to_date(#{start},'yyyy.mm.dd hh24:mi'), cal_end_time = to_date(#{end},'yyyy.mm.dd hh24:mi')
		where cal_no = #{cal_no}
	</update>
	
</mapper>